<?php
// Sécurité basique
if ($_SERVER["REQUEST_METHOD"] != "POST") {
    header("Location: index.html");
    exit();
}

$to = "palmbenz@yahoo.fr";
$subject = "Nouvelle commande depuis BoosteMaCarriere.online";

// Champs
$nom = htmlspecialchars($_POST['nom']);
$prenom = htmlspecialchars($_POST['prenom']);
$telephone = htmlspecialchars($_POST['telephone']);
$email = htmlspecialchars($_POST['email']);
$poste = htmlspecialchars($_POST['poste']);
$candidature = isset($_POST['candidatures']) ? $_POST['candidatures'] : "Non spécifié";

// Message texte
$message = "
Nouvelle commande reçue :

Nom : $nom
Prénom : $prenom
Téléphone : $telephone
Email : $email
Poste recherché : $poste
Offre choisie : $candidature
";

// Gestion du fichier joint
$file = $_FILES['cv'];
if ($file['error'] == UPLOAD_ERR_OK) {
    $tmp_name = $file['tmp_name'];
    $filename = $file['name'];
    $filetype = $file['type'];
    $attachment = chunk_split(base64_encode(file_get_contents($tmp_name)));

    // Email avec pièce jointe (MIME)
    $boundary = md5(time());
    $headers = "From: $prenom $nom <$email>\r\n";
    $headers .= "Reply-To: $email\r\n";
    $headers .= "MIME-Version: 1.0\r\n";
    $headers .= "Content-Type: multipart/mixed; boundary=\"$boundary\"\r\n";

    $body = "--$boundary\r\n";
    $body .= "Content-Type: text/plain; charset=UTF-8\r\n\r\n";
    $body .= "$message\r\n";
    $body .= "--$boundary\r\n";
    $body .= "Content-Type: $filetype; name=\"$filename\"\r\n";
    $body .= "Content-Transfer-Encoding: base64\r\n";
    $body .= "Content-Disposition: attachment; filename=\"$filename\"\r\n\r\n";
    $body .= "$attachment\r\n";
    $body .= "--$boundary--";

    mail($to, $subject, $body, $headers);
} else {
    // Si pas de fichier joint
    $headers = "From: $prenom $nom <$email>\r\n";
    $headers .= "Reply-To: $email\r\n";
    $headers .= "Content-Type: text/plain; charset=UTF-8\r\n";
    mail($to, $subject, $message, $headers);
}

header("Location: merci.html");
exit();
?>
